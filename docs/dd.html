<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Econometrics for Policy Analysis - 9&nbsp; Difference-in-Differences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./treatmenteffects.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Difference-in-Differences</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Econometrics for Policy Analysis</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Syllabus: PMAP 4041, Fall 2024</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Policy Studies</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Mathematics and Econometric Theory</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basicprob.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Basic Probability Theory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stataintro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Stata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./asymptotic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Asymptotic Theory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correlation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Correlation and Association</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ols.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">OLS Explained</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Applied Research Methods</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./treatmenteffects.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Causal Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dd.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Difference-in-Differences</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#underlying-theory-of-dd" id="toc-underlying-theory-of-dd" class="nav-link active" data-scroll-target="#underlying-theory-of-dd"><span class="toc-section-number">9.1</span>  Underlying Theory of DD</a>
  <ul class="collapse">
  <li><a href="#introducing-parallel-trends" id="toc-introducing-parallel-trends" class="nav-link" data-scroll-target="#introducing-parallel-trends"><span class="toc-section-number">9.1.1</span>  Introducing Parallel Trends</a></li>
  <li><a href="#calculating-the-treatment-effect" id="toc-calculating-the-treatment-effect" class="nav-link" data-scroll-target="#calculating-the-treatment-effect"><span class="toc-section-number">9.1.2</span>  Calculating the Treatment Effect</a></li>
  </ul></li>
  <li><a href="#streamlining-dd" id="toc-streamlining-dd" class="nav-link" data-scroll-target="#streamlining-dd"><span class="toc-section-number">9.2</span>  Streamlining DD</a></li>
  <li><a href="#limitations-of-dd" id="toc-limitations-of-dd" class="nav-link" data-scroll-target="#limitations-of-dd"><span class="toc-section-number">9.3</span>  Limitations of DD</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="toc-section-number">10</span>  Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Difference-in-Differences</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the below, let <span class="math inline">\(i\)</span> index the units and <span class="math inline">\(t\)</span> index all time periods. <span class="math inline">\(\mathcal{N}_0\)</span> is the control group, where <span class="math inline">\(i=1\)</span> is the singular treated unit.</p>
</div>
</div>
<p>Even though we cannot randomize all treatments/policies, does this mean that we cannot do policy analysis at all? No.&nbsp;Modern econometrics has developed a slew of methods for doing policy analysis when the intervention of interest simply <em>cannot</em> be subject to a controlled experiment in <a href="https://jgreathouse9.github.io/sample.html">Stata</a>, R, and Python. I now introduce the difference-in-differences method (DD), using Proposition 99 as an example case. DD is a method used for panel data, where we observe multiple units over many periods of time.</p>
<section id="underlying-theory-of-dd" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="underlying-theory-of-dd"><span class="header-section-number">9.1</span> Underlying Theory of DD</h2>
<p>DD is predicated on the idea that we may use the average of our controls as a comparison for one or more treated units. That is, it assumes our outcomes are generated by some time specific effect and some unit specific effect, <span class="math display">\[
y_{it}= a_i + b_t
\]</span></p>
<p>where <span class="math inline">\(a_i\)</span> is the unit specific effect (note the <span class="math inline">\(i\)</span> indexer for <span class="math inline">\(a\)</span>) and <span class="math inline">\(b_t\)</span> is the time effect. The unit component <span class="math inline">\(a_i\)</span> is the unit-stable effect of factors that affect the outcome. We ususally do not expect for these to vary much over time. Examples of unit stable factors include things like culture, geography, hidden/latent economic conditions and aspects we cannot as easily observe. As one of my instructors once said in his thick Kentucky accent, “there is <em>something</em> that makes Alabama, Alabama.” By contrast, the time effect <span class="math inline">\(b_t\)</span> is a time-shock. These are things which we expect to vary across time, but affect the units similarly, such as economic depressions, holidays, or other things we expect to be time-stable, unit variant. The summation of these two factors produces our outcomes, which we econometricians call the two-way fixed effects model.</p>
<p>For DD, units with similar contextual factors will <em>on average</em> be more comaprable in terms of their trends (we will formalize a definition of this more below). For example, suppose we wish to study the impact of <a href="https://en.wikipedia.org/wiki/2023_Hawaii_wildfires">the Maui wildfires</a> on the seasonally adjusted level of tourism. A natural control group for Maui might be Hawai’i, O’ahu, Moloka’i, Lana’i, and Kaua’i. All of these islands may have different levels of tourism. However, due to their relatively similar cultural history and other contextual factors, it may make sense that these islands would serve as a better counterfactual to Maui than say, Honshu, Japan or Palma de Mallorca, since places with the same contextual factors will likely have simialr trends to one another. In other words, due to their baseline similarities, it is more likely that the average trends of these control group islands would move similarly to the Maui, if the fires did not happen. And, if this is true, all we need to do then is estimate whatever the time-differences are between Maui and the control group.</p>
<section id="introducing-parallel-trends" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="introducing-parallel-trends"><span class="header-section-number">9.1.1</span> Introducing Parallel Trends</h3>
<p>We can begin by graphing the trends of our control unit and the trend of the average of controls.</p>
<div class="cell" data-engine="jupyter" data-execution_count="1">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="dd_files/figure-html/cell-2-output-1.png" width="593" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here, we plot the cigarette consumption of California versus the average of control states. We can see in 1970, California is fairly similar to the control average. In fact, the average of controls and California both grow in their consumption rates up until 1976. However as the years progress, the average trend of controls grows at a much faster rate than California’s. California’s smoking trends grew relatively little and begin to precipitously fall in and after 1976, whereas the control group’s trend has much higher rates of smoking. The way to make this plot in Stata would be</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">year</span> id cigsale</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, i(<span class="fu">year</span>) j(id)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> ymean = <span class="fu">rowmean</span>(cigsale1-cigsale39)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">line</span> cigsale3 ymean <span class="fu">year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Either way, we can see that there is a difference between all 38 controls and California when we plot it. But again that’s okay: what if we do not need the means to be balanced exactly? What if we just need for the <em>trends</em> of the groups to be similar enough to one another? DD asks us, as analysts, to accept a singular condition as plausible: namely, that the intercept (time trend) adjusted average of our controls is a good enough proxy for how the treated unit’s outcomes would look absent treatment. This is called the “<em>parallel trends assumption</em>”.</p>
<div id="def-PTA" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.1 (Parallel Trends) </strong></span>The parallel trends assumption says that the difference between the treated group and the control group would have been constant absent the treatment, or <span class="math inline">\(\hat{y}_{1t}^0-\bar{y}_{\mathcal{N}_0t}=\hat\alpha_{\mathcal{N}_0}+ \epsilon\)</span>.</p>
</div>
<p>PTA means that if the intervention never happened, the counterfactual would move in the same way as the average trend of our control group. A good first step to this is simply plotting the trajectory of the treated unit and the averge of controls. However, PTA is inherently untestable globally. Since we only <em>actually</em> observe units as treated or not due to the switching equation, <span class="math inline">\(y_{it}=d_{it}y^{1}_{it}+\left(1-d_{it} \right)y^0_{it}\)</span>, it is ultimately a statement about the counterfactual. So, as a result, the key we shall focus on is the parallel-ness in the pre-intervention period, since this is the only time period we observe all of our units without treatment. To put it a slightly different way, PTAs generally posit that history is the guide to the future: if the control group’s trend behaves similarly to the treated unit in the past, on average, then we simply use this as an extrapolation for the future trend of the treated unit.</p>
<p>For DD, we need at least one treated unit, one control unit, one before period, and one after period (though of course, we may have many pre-treatment periods, and many treated units) <span class="citation" data-cites="ROTH20232218">Roth et al. (<a href="#ref-ROTH20232218" role="doc-biblioref">2023</a>)</span>. For our purposes, the simplest possible setup is the case where we have exactly one control unit, one treated unit, and more than one pre and post intervention time period. Let’s just look at how the trends of individual controls compares to single control units.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">foreach</span> x <span class="kw">of</span> numlist 13 10 2 39 38 7 14 4 17 26 27 34 31 5  {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>loc newstate = <span class="ot">`x'</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> state <span class="kw">if</span> id ==<span class="ot">`newstate'</span>, loc(cstate) <span class="kw">clean</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> cigsale</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, j(id) i(<span class="fu">year</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> ymeangood ydiff ymean <span class="kw">cf</span> <span class="kw">te</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">`ymean'</span> = <span class="fu">rowmean</span>(cigsale<span class="ot">`newstate'</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>*** Normal DID, <span class="ot">all</span> controls</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`ydiff'</span> = cigsale3-<span class="ot">`ymean'</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="ot">`ydiff'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>loc <span class="kw">alpha</span> = <span class="fu">e</span>(b)[1,1] <span class="co">// here is the intercept shift</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`cf'</span> = <span class="ot">`ymean'</span> + <span class="ot">`alpha'</span> <span class="co">// DID Counterfacutal</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (connected cigsale3 <span class="fu">year</span> <span class="kw">if</span> <span class="fu">year</span> , mcolor(<span class="bn">black</span>) msize(small) <span class="bn">msymbol</span>(smcircle) lcolor(<span class="bn">black</span>) lwidth(<span class="bn">medthick</span>)) <span class="co">///</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    (connected cigsale<span class="ot">`newstate'</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smsquare) lcolor(gs11) lpattern(solid) lwidth(thin)), <span class="co">///</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ylabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="bn">xline</span>(1989, lwidth(medium) lpattern(solid) lcolor(<span class="bn">black</span>)) <span class="co">///</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xlabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="bn">cols</span>(1) <span class="co">///</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="bn">position</span>(7) <span class="co">///</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"`cstate'"</span>) <span class="co">///</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    region(fcolor(<span class="kw">none</span>) lcolor(<span class="kw">none</span>)) <span class="bn">ring</span>(0)) <span class="co">///</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="dv">scheme</span>(sj) <span class="co">///</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    graphregion(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="bn">plotregion</span>(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="bn">name</span>(badplot<span class="ot">`x'</span>, <span class="kw">replace</span>) yti(Cigarette Sales) ti(<span class="st">"`cstate' as a Control"</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Nothing crazy is happening here. I’ve just plotted the trend of California versus the tobacco consumption trends of a few randomly selected controls. Now, we will begin to consider testing for parallel trends in the pre-intervention period, with each control unit. One way of doing this, and there are others, is by simply using OLS. Consider the definition of PTA above, where the following equation holds: <span class="math inline">\(\hat{y}_{1t}^0-\bar{y}_{\mathcal{N}_0t}=\hat\alpha_{\mathcal{N}_0}+ \epsilon\)</span>. Notice anything funny about this equation? Well… We can actually estimate this as a linear regression model, where we only have one variable!</p>
<div class="goals">
<div class="goals-header">
<p>Why?</p>
</div>
<div class="goals-container">
<p>Here is the definition of PTA: <span class="math inline">\(\hat{y}_{1t}^0-\bar{y}_{\mathcal{N}_0t}=\hat\alpha_{\mathcal{N}_0}+ \epsilon\)</span>. We can calculate <span class="math inline">\(\bar{y}_{\mathcal{N}_0t} = \frac{1}{|\mathcal{N}_0|} \sum_{i \in \mathcal{N}_0} y_{it}\)</span>, or the control group average. Here, <span class="math inline">\(\mathcal{N}_0\)</span> is defined as all the units in the control group, <span class="math inline">\(|\mathcal{N}_0|\)</span> is the number of control units, and the overbar means that we are calculating the sample mean. For this univariate regression model, we simply subtract (or, demean) the control group average from the treated unit is outcomes. Let this demeaned <span class="math inline">\(y_{1t}\)</span> be denoted as <span class="math inline">\(\tilde{y}_{1t}=y_{1t}-\bar{y}_{\mathcal{N}_0t}\)</span> We then estimate the regression model <span class="math inline">\(\tilde{y}_{1t}=\hat\alpha_{\mathcal{N}_0}+ \epsilon\)</span>. Our variable of interest here is simply the demeaned value of the treated outcomes, and we aer in effect estimating the constant.</p>
</div>
</div>
<p>To connect this to OLS, DD seeks the value of the <span class="math inline">\(\alpha\)</span> (the constant) which minimizes the distance between the control group and the treated unit. Here we do this with multiple plots, using a single control unit.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">// DID one control each unit</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">foreach</span> x <span class="kw">of</span> numlist 22 13 2 7  17 27 26 39 14 5 31 38 10  34  4 19 {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>loc newstate = <span class="ot">`x'</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> state <span class="kw">if</span> id ==<span class="ot">`newstate'</span>, loc(cstate) <span class="kw">clean</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> cigsale</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, j(id) i(<span class="fu">year</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> ymeangood ytilde ymean <span class="kw">cf</span> <span class="kw">te</span> rss tss</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">`ymean'</span> = <span class="fu">rowmean</span>(cigsale<span class="ot">`newstate'</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`ytilde'</span> = cigsale3-<span class="ot">`ymean'</span> <span class="co">// here is the demeaning step I mention above</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="ot">`ytilde'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989 <span class="co">// univariate regression</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>loc <span class="kw">alpha</span> = <span class="fu">e</span>(b)[1,1] <span class="co">// here is the intercept shift</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">// this step above gives us the intercept shift that</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">// corresponds to the average differnece between California and</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">// the single treated unit</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`cf'</span> = <span class="ot">`ymean'</span> + <span class="ot">`alpha'</span> <span class="co">// DID Counterfacutal</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> cigsale3 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989, <span class="kw">mean</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> mean_observed = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>* Calculate the Total Sum <span class="kw">of</span> Squares (TSS)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`tss'</span> = (cigsale3 - <span class="ot">`mean_observed'</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`tss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> TSS = <span class="fu">r</span>(<span class="kw">sum</span>) </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>* Calculate the Residual Sum <span class="kw">of</span> Squares (RSS)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`rss'</span> = (cigsale3 - <span class="ot">`cf'</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989 <span class="co">//pre period r2</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`rss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> RSS = <span class="fu">r</span>(<span class="kw">sum</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>loc r2 = 1 - (<span class="ot">`RSS'</span> / <span class="ot">`TSS'</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (connected cigsale3 <span class="fu">year</span> <span class="kw">if</span> <span class="fu">year</span> , mcolor(<span class="bn">black</span>) msize(small) <span class="bn">msymbol</span>(smcircle) lcolor(<span class="bn">black</span>) lwidth(<span class="bn">medthick</span>)) <span class="co">///</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    (connected cigsale<span class="ot">`newstate'</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smsquare) lcolor(gs11) lpattern(solid) lwidth(thin)) <span class="co">///</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    (connected <span class="ot">`cf'</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smtriangle) lcolor(gs11) lwidth(thin)), <span class="co">///</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ylabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="bn">xline</span>(1989, lwidth(medium) lpattern(solid) lcolor(<span class="bn">black</span>)) <span class="co">///</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xlabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="bn">cols</span>(1) <span class="co">///</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="bn">position</span>(7) <span class="co">///</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"`cstate'"</span> 3 <span class="st">"DID California"</span>) <span class="co">///</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    region(fcolor(<span class="kw">none</span>) lcolor(<span class="kw">none</span>)) <span class="bn">ring</span>(0)) <span class="co">///</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="dv">scheme</span>(sj) <span class="co">///</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    graphregion(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="bn">plotregion</span>(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    <span class="bn">name</span>(plot<span class="ot">`x'</span>, <span class="kw">replace</span>) yti(Cigarette Sales) ti(<span class="st">"`cstate' as a Control: R2 = `r2'"</span>) <span class="co">///</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    subti(<span class="kw">alpha</span>: <span class="ot">`alpha'</span>)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code estimates a one unit DD model, using various different states as the <em>single</em> control unit. Again for emphasis, the alpha term is the time-fixed effect as I described above. The control unit, in this case, is the proxy for the unit fixed effect, or the latent factors that generate the outcome. I begin with New Hampshire and Kentucky. We can see that these controls are clearly not parallel to California in the pre 1989 period. Why not? Well… their trends are not similar. New Hampshire’s trend of tobacco consumption is plummeting relative to California in the pre-1989 period. Its trends of tobacco consumption were also increasing by a lot in the pre-treatment period relative to California. It even has a negative R-squared statistic, meaning it <em>harms</em> our ability to predict the sales trends for California.</p>
<p>Kentucky also has a negative R-squared. Its consumption trends rise a lot into the 1970s, and decline at a slower rate than California’s. When we look at the DD California (which is literally just New Hamphshire/Kentucky minus <span class="math inline">\(\alpha\)</span> (<code>alpha</code> from the code), we see that the predictions (the line with the triangles) does not line up very well with California before 1989. Now… fast forward to the very end of the graph window in Stata, looking at plot19. See the state of Montana? Its consumption trend, when shifted by an intercept, does well at explaining the pre-intervention trend of California.</p>
<p>See how while even though their trends are not 100% the same, they are similar? Plot4, for Colorado, does the same, also appearing to fit California well in the pre policy period. To illustrate this more, consdider what would happen if we used two poor controls, Kentucky and New Hampshire</p>
<p>Here is the worse plot (NH + Kentucky)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">// NH Kentucky</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>xtdescribe</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>loc newstate = 13 <span class="co">// 13 =Kentucky</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">levelsof</span> state <span class="kw">if</span> id ==<span class="ot">`newstate'</span>, loc(cstate) <span class="kw">clean</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> cigsale</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, j(id) i(<span class="fu">year</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> ymean = <span class="fu">rowmean</span>(cigsale22 cigsale13)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>*** DID, bad controls</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>g ydiff = cigsale3-ymean</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> ydiff <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>loc <span class="kw">alpha</span> = <span class="fu">e</span>(b)[1,1] <span class="co">// here is the intercept shift</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>g <span class="kw">cf</span> = ymean + <span class="ot">`alpha'</span> <span class="co">// DID Counterfacutal</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> tss rss</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> cigsale3 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989, <span class="kw">mean</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> mean_observed = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>* Calculate the Total Sum <span class="kw">of</span> Squares (TSS)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`tss'</span> = (cigsale3 - <span class="ot">`mean_observed'</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`tss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> TSS = <span class="fu">r</span>(<span class="kw">sum</span>) </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>* Calculate the Residual Sum <span class="kw">of</span> Squares (RSS)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`rss'</span> = (cigsale3 - <span class="kw">cf</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989 <span class="co">//pre period r2</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`rss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> RSS = <span class="fu">r</span>(<span class="kw">sum</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>loc r2 = 1 - (<span class="ot">`RSS'</span> / <span class="ot">`TSS'</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (connected cigsale3 <span class="fu">year</span>, mcolor(<span class="bn">black</span>) msize(small) <span class="bn">msymbol</span>(smcircle) lcolor(<span class="bn">black</span>) lwidth(<span class="bn">medthick</span>)) <span class="co">///</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    (connected ymean <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smsquare) lcolor(gs11) lpattern(solid) lwidth(thin)) <span class="co">///</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    (connected <span class="kw">cf</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smtriangle) lcolor(gs11) lwidth(thin)), <span class="co">///</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ylabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    <span class="bn">xline</span>(1989, lwidth(medium) lpattern(solid) lcolor(<span class="bn">black</span>)) <span class="co">///</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xlabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="bn">cols</span>(1) <span class="co">///</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="bn">position</span>(7) <span class="co">///</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"KY+NH Average"</span> 3 <span class="st">"DID California"</span>) <span class="co">///</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    region(fcolor(<span class="kw">none</span>) lcolor(<span class="kw">none</span>)) <span class="bn">ring</span>(0)) <span class="co">///</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="dv">scheme</span>(sj) <span class="co">///</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    graphregion(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    <span class="bn">plotregion</span>(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="bn">name</span>(worseplot, <span class="kw">replace</span>) yti(Cigarette Sales) ti(<span class="st">"R2: `r2'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can see that this code does poorly. However it is still the same in principle. The average of these controls minus the outcomes of the treated unit, being used as a proxy for how the treated unit would look in the post-intervention period (<code>g cf = ymean + alpha</code>) from above.</p>
<p>Now suppose we used another control group</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> cigsale</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, j(id) i(<span class="fu">year</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> ymeangood</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> ymean = <span class="fu">rowmean</span>(cigsale4 cigsale19 cigsale5 cigsale21) </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>g ydiff = cigsale3-ymean</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>*** Using some controls</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> ydiff <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>loc <span class="kw">alpha</span> = <span class="fu">e</span>(b)[1,1] <span class="co">// here is the intercept shift</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>g <span class="kw">cf</span> = ymean + <span class="ot">`alpha'</span> <span class="co">// DID Counterfacutal</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> tss rss</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> cigsale3 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989, <span class="kw">mean</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> mean_observed = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>* Calculate the Total Sum <span class="kw">of</span> Squares (TSS)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`tss'</span> = (cigsale3 - <span class="ot">`mean_observed'</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`tss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> TSS = <span class="fu">r</span>(<span class="kw">sum</span>) </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>* Calculate the Residual Sum <span class="kw">of</span> Squares (RSS)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`rss'</span> = (cigsale3 - <span class="kw">cf</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989 <span class="co">//pre period r2</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`rss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> RSS = <span class="fu">r</span>(<span class="kw">sum</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>loc r2 = 1 - (<span class="ot">`RSS'</span> / <span class="ot">`TSS'</span>)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (connected cigsale3 <span class="fu">year</span>, mcolor(<span class="bn">black</span>) msize(small) <span class="bn">msymbol</span>(smcircle) lcolor(<span class="bn">black</span>) lwidth(<span class="bn">medthick</span>)) <span class="co">///</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    (connected ymean <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smsquare) lcolor(gs11) lpattern(solid) lwidth(thin)) <span class="co">///</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    (connected <span class="kw">cf</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smtriangle) lcolor(gs11) lwidth(thin)), <span class="co">///</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ylabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="bn">xline</span>(1989, lwidth(medium) lpattern(solid) lcolor(<span class="bn">black</span>)) <span class="co">///</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xlabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="bn">cols</span>(1) <span class="co">///</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="bn">position</span>(7) <span class="co">///</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"Control Group Average"</span> 3 <span class="st">"DID California"</span>) <span class="co">///</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    region(fcolor(<span class="kw">none</span>) lcolor(<span class="kw">none</span>)) <span class="bn">ring</span>(0)) <span class="co">///</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="dv">scheme</span>(sj) <span class="co">///</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    graphregion(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="bn">plotregion</span>(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="bn">name</span>(goodplot, <span class="kw">replace</span>) yti(Cigarette Sales) ti(<span class="st">"R2: `r2'"</span>) <span class="co">///</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    subti(<span class="st">"Montana, Colorado, Connecticut, Nevada"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See? This control group sure looks a lot more parallel than using one individual state, and it also looks a lot better than using Kentucky or New Hampshire. Now that we have a sense of how it works on the most basic level with one and two controls, let’s consider this with the full control group. This code will be a lot simpler.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> cigsale</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, j(id) i(<span class="fu">year</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> ymeangood ytilde ymean <span class="kw">cf</span> <span class="kw">te</span> rss tss</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">`ymean'</span> = <span class="fu">rowmean</span>(cigsale1-cigsale39)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>*** DID <span class="kw">using</span> <span class="ot">all</span> controls</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`ytilde'</span> = cigsale3-<span class="ot">`ymean'</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="ot">`ytilde'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>loc <span class="kw">alpha</span> = <span class="fu">e</span>(b)[1,1] <span class="co">// here is the intercept shift</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`cf'</span> = <span class="ot">`ymean'</span> + <span class="ot">`alpha'</span> <span class="co">// DID Counterfacutal</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> cigsale3 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989, <span class="kw">mean</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> mean_observed = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>* Calculate the Total Sum <span class="kw">of</span> Squares (TSS)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`tss'</span> = (cigsale3 - <span class="ot">`mean_observed'</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`tss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> TSS = <span class="fu">r</span>(<span class="kw">sum</span>) </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>* Calculate the Residual Sum <span class="kw">of</span> Squares (RSS)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">generate</span> <span class="kw">double</span> <span class="ot">`rss'</span> = (cigsale3 - <span class="ot">`cf'</span>)^2 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989 <span class="co">//pre period r2</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">summarize</span> <span class="ot">`rss'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> RSS = <span class="fu">r</span>(<span class="kw">sum</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>loc r2 = 1 - (<span class="ot">`RSS'</span> / <span class="ot">`TSS'</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (connected cigsale3 <span class="fu">year</span>, mcolor(<span class="bn">black</span>) msize(small) <span class="bn">msymbol</span>(smcircle) lcolor(<span class="bn">black</span>) lwidth(<span class="bn">medthick</span>)) <span class="co">///</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    (connected  <span class="ot">`ymean'</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smsquare) lcolor(gs11) lpattern(solid) lwidth(thin)) <span class="co">///</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    (connected <span class="ot">`cf'</span> <span class="fu">year</span>, mcolor(gs11) msize(small) <span class="bn">msymbol</span>(smtriangle) lcolor(gs11) lwidth(thin)), <span class="co">///</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ylabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="bn">xline</span>(1989, lwidth(medium) lpattern(solid) lcolor(<span class="bn">black</span>)) <span class="co">///</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xlabel</span>(#10, <span class="bn">grid</span> glwidth(vthin) glcolor(gs8%20) glpattern(<span class="kw">dash</span>)) <span class="co">///</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="bn">cols</span>(1) <span class="co">///</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="bn">position</span>(7) <span class="co">///</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"Control Average"</span> 3 <span class="st">"DID California"</span>) <span class="co">///</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    region(fcolor(<span class="kw">none</span>) lcolor(<span class="kw">none</span>)) <span class="bn">ring</span>(0)) <span class="co">///</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="dv">scheme</span>(sj) <span class="co">///</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    graphregion(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="bn">plotregion</span>(fcolor(<span class="bn">white</span>) lcolor(<span class="bn">white</span>) ifcolor(<span class="bn">white</span>) ilcolor(<span class="bn">white</span>)) <span class="co">///</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="bn">name</span>(plotall, <span class="kw">replace</span>) yti(Cigarette Sales) ti(<span class="st">"All Controls: R2 = `r2'"</span>) <span class="co">///</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    subti(<span class="kw">alpha</span>: <span class="ot">`alpha'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What do we get here? Well, we see that the control group average is not very parallel to the treated unit is pretreatment outcomes (likely because of NH and Kentucky being included in the sample). One way we can check and see if parallel trends holds grahpically is by using a histogram. A histogram simply plots the distribution of a variable.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (<span class="kw">histogram</span> cigsale3 <span class="kw">if</span> <span class="fu">year</span> &lt; 1989, fcolor(<span class="bn">ltblue</span>%50)) (<span class="kw">histogram</span> <span class="kw">cf</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989, fcolor(<span class="kw">red</span>%50))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ideally, they will overlap as much as possible. Why? Well, if they overlap, if their distributions are very very similar, it is more likely the control group we used was also very similar to the treated unit, but for the treatmeent. As an exercise, do this with the other control group.</p>
</section>
<section id="calculating-the-treatment-effect" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="calculating-the-treatment-effect"><span class="header-section-number">9.1.2</span> Calculating the Treatment Effect</h3>
<p>Okay, at this point, you may be wondering “Okay this is fine, but how do I estimate the treatment effect? That’s why we’re here aren’t we?” Yes. The way we do this is quite simple. We can begin by defining the counterfactual</p>
<div id="def-cf" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.2 (DD Counterfactual) </strong></span><span class="math inline">\(\hat{y}_{1t}^0=\hat\alpha_{\mathcal{N}_0}+\bar{y}_{\mathcal{N}_0t}\)</span>.</p>
</div>
<p>With this in mind, consider the following code</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> cigsale</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">reshape</span> <span class="kw">wide</span> cigsale, j(id) i(<span class="fu">year</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> cigsale3, a(<span class="fu">year</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> ymeangood ytilde ymean <span class="kw">cf</span> <span class="kw">te</span> rss tss</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">`ymean'</span> = <span class="fu">rowmean</span>(cigsale1-cigsale39)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>*** Normal DID, <span class="ot">all</span> controls</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>g <span class="ot">`ytilde'</span> = cigsale3-<span class="ot">`ymean'</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="ot">`ytilde'</span> <span class="kw">if</span> <span class="fu">year</span> &lt; 1989</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>loc <span class="kw">alpha</span> = <span class="fu">e</span>(b)[1,1] <span class="co">// here is the intercept shift</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>g <span class="kw">cf</span> = <span class="ot">`ymean'</span> + <span class="ot">`alpha'</span> <span class="co">// DID Counterfacutal</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>g <span class="kw">te</span> = cigsale3 - <span class="kw">cf</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">year</span> cigsale3 <span class="kw">cf</span> <span class="kw">te</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>br</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What do we see from the Stata browser window? We see the observed values minus the DID predictions. Here, <code>te</code> is the difference between the observed values and the predictions, <span class="math inline">\(y_{1t} - \hat{y}_{1t}^0\)</span>. We then take the average of this over the post-intervention period (on and after 1989, 12 years in total), <span class="math inline">\(\widehat{ATT}_{\mathcal{N}_0} = \frac{1}{T_2} \sum_{t \in \mathcal{T}_2} \left(y_{1t} - \hat{y}_{1t}^0\right)=-27.349\)</span>. In Stata, we can do this with the code <code>su te if year &gt;=1989</code>, which returns the same number. Here, ATT stands for the average treatment effect on the treated.</p>
</section>
</section>
<section id="streamlining-dd" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="streamlining-dd"><span class="header-section-number">9.2</span> Streamlining DD</h2>
<p>Of course though, all this was very involved. Some way wonder if we can further use regression to streamline this… and indeed we can. One way we can do this is using an interaction term. We’ve discussed this before, in previous lectures in the context of calculating nonlinearities. But we can do the same with treatment effect estimation. Consider the code</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> *</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>cls</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>u <span class="st">"https://github.com/jgreathouse9/FDIDTutorial/raw/main/smoking.dta"</span>, <span class="kw">clear</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> treated = <span class="fu">cond</span>(id==3,1,0)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>g <span class="kw">post</span>= <span class="fu">cond</span>(<span class="fu">year</span> &gt;=1989,1,0)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">year</span> treated <span class="kw">post</span> cigsale</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> cigsale i.treated##i.<span class="kw">post</span>, <span class="kw">vce</span>(cl id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Okay so, here we load in the Proposition 99 data. We then create a dummy variable for whether the state is California or not (that is, if it is treated ever). We then create another dummy for whether the time period is in the post-intervention period. We use the <code>##</code> notation to create the interaction term. The regression equation itself takes the form of</p>
<p><span class="math display">\[
\begin{equation}
Y_{it} = \beta_0 + \beta_1 \text{Treated}_i + \beta_2 \text{Post}_t + \beta_3 (\text{Treated}_i \times \text{Post}_t) + \epsilon_{it}
\end{equation}
\]</span></p>
<p>Again, none of this is in principle different from what we’ve seen before. the constant is still the average of our outcomes if all our <span class="math inline">\(x\)</span>-s are 0. The first beta represents the baseline differences between the treated unit and the control group when the period is before treatment. The second beta is the average of the control group outcomes in the post=intervention period… and the iteraction term is simply the effect of being in the treated group and in the post intervention period. The output of the Stata code is</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Linear regression                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      1,209</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">F</span>(1, 38)          =          .</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                                Prob &gt; <span class="fu">F</span>          =          .</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                                R-squared         =     0.2073</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                                Root MSE          =     29.209</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                    (Std. err. adjusted <span class="kw">for</span> 39 clusters <span class="kw">in</span> id)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>             |               Robust</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>     cigsale | Coefficient  <span class="fu">std</span>. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>   1.treated |    -14.359   4.961268    -2.89   0.006    -24.40256   -4.315442</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      1.<span class="kw">post</span> |  -28.51142   2.769628   -10.29   0.000    -34.11823    -22.9046</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>             |</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>treated#post |</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        1 1  |  -27.34911   2.769628    -9.87   0.000    -32.95593   -21.74229</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>             |</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   130.5695   4.961268    26.32   0.000      120.526    140.6131</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Some of this should look familiar. Such as, the <code>-14.359</code>, which is the exact same number we got when we manually calculated the averge of the differences. The <code>treated#post</code> coefficient also looks familiar; its our average treatment effect on the treated!! Notice how it is the same as above, with the same result as <code>su te if year &gt;=1989</code>. It reflects the effect of a unit being both treated (California in this case) AND being in the post-intervention period, the period we care about most. For our purposes, this is the coefficient we care the most about, since it tells us if our policy was successful or not.</p>
<p>We can also calculate confidence intervals with DID, as we see from the Stata output above. In this case, we say that we are 95% confident, given the dataset, that the true effect of Prop 99 led to a reduction of 32 cigarettes per capita smoked per year in California, or as little of a reduction of 21 cigarettes per capita smoked, from 1989 to 2000.</p>
</section>
<section id="limitations-of-dd" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="limitations-of-dd"><span class="header-section-number">9.3</span> Limitations of DD</h2>
<p>As we have discussed so far, parallel trends holds if the difference between the treated unit and control group would be similar absent treatment. However, this is a strong assumption to make: it essentially assumes that across the whole control group, the only thing really changing the outcome aside from the treatment was some time effect. However, this may be a dubious assumption: maybe, unit specific factors will interact with time in a way unique to that unit only. In other words, maybe the simple two-way fixed effect model is much too simplistic.</p>
<p>Another limitation of DD is implicit in the regression equation: by now, hopefully we can see how that DD is, at tis heart, just a substraction of the pre-intervention mean from the control group mean. What this means, practically, is that DD presumes each control unit we have in our control group is a good control unit for one or more treated units. Therefore, all control units are given <em>the same weight</em> in the construction of the counterfactual. However, maybe this is unrealistic. Indeed, maybe some control units should matter more than other control units. After all, if Wailuku, Hawaii does an anti-crime policy, should New Orleans be given the same weight as Makakilo, Hawaii? No.&nbsp;Likely not, anyways. New Orleans is completely different from Wailuku, and therefore likely should not be used as a comparison unit at all. <a href="https://www.urban.org/sites/default/files/2022-05/An%20Update%20on%20the%20Synthetic%20Control%20Method%20as%20a%20Tool%20to%20Understand%20State%20Policy.pdf">Other methods</a> have been developed for this.</p>
</section>
<section id="summary" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Summary</h1>
<p>The DD method is the baseline method we use for program evaluation in public policy analysis. It is the most elementary method we use aside from the randomized controlled trial to evaluate the effect of a policy even when we cannot randomize the policy. It operates under the PTA, or the notion that the counterfactual for the treated unit would have moved the same way as the average of the control group. <a href="https://asjadnaqvi.github.io/DiD/docs/code">Numerous extensions</a> have been developed for DD. It is the most popular method of evaluating the effect of policies, and is valued for its simplicity to compute, inference theory, and applicability in various research settings, while also being coded across various softwares. The key message though, for your papers, remains the same: using statistical methods to evaluate the impact of a policy you’ve chosen.</p>
<p>A final note, just in terms of doing science: I’ve never mentioned things such as the p-value in my interpretation of the regression results, the measure for statistical significance commonly employed in social science research. The reason for this is because just because the p-value for a regression coefficient is below <span class="math inline">\(0.05\)</span> does not mean your analysis is correct or that you have done your job as a research. No, indeed, by my standards, the design, the way we set up the identification of the counterfactual matters. It <a href="https://projecteuclid.org/journals/annals-of-applied-statistics/volume-2/issue-3/For-objective-causal-inference-design-trumps-analysis/10.1214/08-AOAS187.full">completely trumps estimation</a>.</p>
<p>Therefore, for your papers, you’ll mainly be graded also in terms of whether or not you can identify the violation/applicability of DD’s parallel trend assumption, as well as the limitations of the method for your case. So, your goal is not to have “the final say” on whether policy <span class="math inline">\(x\)</span> worked or not; the goal is to get you to think like a policy analyst who views the world through a cause and effect lens, and being able to use and articulate designs such as DD are a useful way of beginning this.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-ROTH20232218" class="csl-entry" role="doc-biblioentry">
Roth, Jonathan, Pedro H.C. Sant’Anna, Alyssa Bilinski, and John Poe. 2023. <span>“What’s Trending in Difference-in-Differences? A Synthesis of the Recent Econometrics Literature.”</span> <em>Journal of Econometrics</em> 235 (2): 2218–44. <a href="https://doi.org/10.1016/j.jeconom.2023.03.008">https://doi.org/10.1016/j.jeconom.2023.03.008</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./treatmenteffects.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Causal Inference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>